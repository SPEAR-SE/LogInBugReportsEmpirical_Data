{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12406599","self":"https://issues.apache.org/jira/rest/api/2/issue/12406599","key":"HADOOP-4428","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2008-10-16T14:19:53.678+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Nov 17 05:17:12 UTC 2008","customfield_12310420":"43652","customfield_12312320":null,"customfield_12310222":"10002_*:*_2_*:*_2633118499_*|*_1_*:*_2_*:*_101109169_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_324193669","customfield_12312321":null,"resolutiondate":"2008-11-17T05:17:12.868+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4428/watchers","watchCount":3,"isWatching":false},"created":"2008-10-16T13:46:45.200+0000","customfield_12310192":null,"customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313211","id":"12313211","description":"","name":"0.19.0","archived":false,"released":true,"releaseDate":"2008-11-20"}],"issuelinks":[{"id":"12322067","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322067","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12406902","key":"HADOOP-4471","self":"https://issues.apache.org/jira/rest/api/2/issue/12406902","fields":{"summary":"Capacity Scheduler should maintain the right ordering of jobs in its running queue","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sreekanth","name":"sreekanth","key":"sreekanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sreekanth Ramakrishnan","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-08T16:40:32.137+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Job Priorities are not handled properly ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12392491","id":"12392491","filename":"HADOOP-4428.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-20T15:09:56.145+0000","size":16493,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12392491/HADOOP-4428.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12392363","id":"12392363","filename":"HADOOP-4428-20081017.1.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-17T17:46:56.245+0000","size":10538,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12392363/HADOOP-4428-20081017.1.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12392459","id":"12392459","filename":"HADOOP-4428-20081020.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-20T07:19:51.468+0000","size":10967,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12392459/HADOOP-4428-20081020.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"104318","customfield_12312823":null,"summary":"Job Priorities are not handled properly ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=karams","name":"karams","key":"karams","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karam Singh","active":true,"timeZone":"Asia/Kolkata"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=karams","name":"karams","key":"karams","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karam Singh","active":true,"timeZone":"Asia/Kolkata"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Cluster:  106 TTs  MapCapacity=212, ReduceCapacity=212\nSingle Queue=default, User Limit=25, Priorities = Yes.\nUsing hadoop branch 0.19 revision=705159 ","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640163","id":"12640163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=karams","name":"karams","key":"karams","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karam Singh","active":true,"timeZone":"Asia/Kolkata"},"body":"TestCase-1:\nSubmitted 6 jobs at same time with different users as follows -:\nUser1 Job1 maps=reduces=212 priority=VERY_LOW\nUser2 Job2 maps=reduces=212 priority=LOW\nUser3 Job3 maps=reduces=212 priority=HIGH\nUser4 Job4 maps=reduces=212 priority=VERY_HIGH\nUser5 Job5 maps=reduces=212 priority=VERY_LOW\nUser6 Job6 maps=reduces=212 priority=VERY_HIGH\n\nThe JobTracker UI shows all 6 jobs as running with -:\nJ1, maps=reduces=53 running, Priority =VERY_LOW\nJ2, maps=reduces=0 running, Priority=LOW\nJ3, maps=, reduces=53 running, Priority=HIGH\nJ4, maps=reduces=0 running, Priority=VERY_HIGH\nJ5, maps=reduces=53, Priority=VERY_LOW\nJ6, maps=reduces=53, Priority=VERY_HIGH\n\nWhere expected behavior should like -:\nMaps and reduces of J2, J3, J4, J6 start running while maps and reduces J1, J5 remain in queue.\n \nTestCase-2:\nFirst submitted J1, User7 maps=reduces=212 priority=NORMAL. (SleepJob with -rt=1)\nWhen J1 started running, submitted 6 jobs at same time with different users -:\nUser1 Job2 maps=reduces=212 priority=VERY_LOW\nUser2 Job3 maps=reduces=212 priority=LOW\nUser3 Job4 maps=reduces=212 priority=HIGH\nUser4 Job5 maps=reduces=212 priority=VERY_HIGH\nUser5 Job6 maps=reduces=212 priority=VERY_LOW\nUser6 Job7 maps=reduces=212 priority=VERY_HIGH\n\n\"hadoop job -list\" shows state of J2-J7 =4. When maps of J1 started finishing J2-J7 started running. The JobTracker UI shows status after J1 finishes as -:\n\nJ2, maps=reduces=53 running, Priority =VERY_LOW\nJ3, maps=reduces=53 running, Priority=LOW\nJ4, maps=, reduces=0 running, Priority=HIGH\nJ5, maps=reduces=53 running, Priority=VERY_HIGH\nJ6, maps=reduces=53, Priority=VERY_LOW\nJ7, maps=reduces=0, Priority=VERY_HIGH\n\n\nWhere Expected behavior should be -:\nMaps and reduces of J3, J4, J5, J7 start running while maps and reduces J2, J6 remain in queue.\n\nNote -: Preivously it was working as expected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=karams","name":"karams","key":"karams","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karam Singh","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-16T13:47:36.945+0000","updated":"2008-10-16T13:47:36.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640177","id":"12640177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"I think this happens because of the set-up tasks introduced in HADOOP-4261.\n\nEarlier, jobs were initialized and moved into the running-job's queue in the order of their presence in waiting-jobs' queue which is by priority (and more).\n\nNow, even though jobs are initialized according to their order in waiting-jobs' queue, depending on the time taken for successful return and reporting of set-up tasks. jobs may be moved out of order into the running-jobs' queue(a linked list). Also, JobTracker launches set-up tasks of initialized jobs in the order of its own jobs TreeMap data structure which stores jobs in the order of JobIDs. I think the later combined with the former explains the behavior explained by Karam.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-16T14:19:53.678+0000","updated":"2008-10-16T14:19:53.678+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640181","id":"12640181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Don't know for sure if this is the right fix, but one way of solving this is by maintaining a sorted order of running-jobs queue, just like waiting job's queue. Then, irrespective of the order in which set-up tasks get launched and return, running jobs would be served in the order of priority.\n\nOne effect of the above fix is that, a higher priority job that is submitted after a lower priority job starts running, though will not preempt tasks of lower priority job, will be given more importance once there are free slots or once tasks of lower priority job started finishing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-16T14:30:19.339+0000","updated":"2008-10-16T14:30:19.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640500","id":"12640500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"Initial diagnosis shows that this should be a blocker for Hadoop 0.19 as there is a deeper impact. The change is related to the newly introduced setup tasks. The impact seems to be that the capacity scheduler is actually initializing more jobs than it is supposed to.\n\nThe fix, at first sight, appears to be straightforward too, in the capacity scheduler.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-17T11:16:26.810+0000","updated":"2008-10-17T11:16:26.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640547","id":"12640547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"My analysis of the cause is correct, but the proposed fix doesn't work as I've learnt that running jobs shouldn't be preempted no matter what, meaning that running jobs take higher precedence over waiting jobs irrespective of job priorities.\n\nThe correct fix, as I've discussed with Hemanth, is that when running jobs don't have anything to run, the first job in the waiting queue should be initialized, but nothing can be returned to the TT as we have to wait for job set-up. TTs that come later should also be returned no task till the job that is initialized moves to running queue after set-up is done. This way we make sure that jobs in waiting queue are served in the order of their priority.\n\nI already have a patch for this, working on test-cases. Will put it up on the JIRA asap.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-17T15:46:06.756+0000","updated":"2008-10-17T15:46:06.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640596","id":"12640596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching patch to fix the issue. This also has test-cases to test how waiting jobs are treated and to test that priorities are respected for jobs in the queue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-17T17:46:56.286+0000","updated":"2008-10-17T17:46:56.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640597","id":"12640597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Running it through Hudson.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-17T17:49:39.581+0000","updated":"2008-10-17T17:49:39.581+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640751","id":"12640751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12392363/HADOOP-4428-20081017.1.txt\n  against trunk revision 705831.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3491/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3491/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3491/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3491/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-18T05:38:41.094+0000","updated":"2008-10-18T05:38:41.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640927","id":"12640927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Few comments :\n1) The other {{submitJob}} api in {{TestCapacityScheduler}} should call the new {{submitJob}} api with {{NORMAL}} priority.\n2) {{testJobPriorities()}} : What is the need to running a large job that takes up the cluster? Wouldn't a tasktracker with just one slot suffice? Something like this\n{code}\n1) submit 5 jobs with different priorities\n2) check if they are sorted as expected\n3) init the first job in the waiting queue.\n4) check assignTasks() to see if no task is assigned.\n5) launch setup tasks for the first job in the waiting queue\n6) check assignTasks() to see if the result is as expected\n7) finish the just launched task to free up the slot\n8) do (5), (6) and (7) for other jobs in the waiting queue.\n{code}\n\nRest of the code looks fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-20T05:49:23.873+0000","updated":"2008-10-20T05:49:23.873+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640937","id":"12640937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"+1 for the code changes.\n\nRegarding tests:\n\n- +1 for Amar's comment on reusing submitJob API\n- Regarding the testJobPriorities(), I think this is simulating the actual error condition that was reported in the bug. Hence, +1 for leaving the test as is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-20T06:57:34.228+0000","updated":"2008-10-20T06:57:34.228+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640941","id":"12640941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Attaching new patch reusing the submitJob API in the test-case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-20T07:19:51.579+0000","updated":"2008-10-20T07:19:51.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640942","id":"12640942","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"+1 for the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-20T07:52:05.382+0000","updated":"2008-10-20T07:52:05.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640950","id":"12640950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"Few comments :\n1) Plz make sure that there are no unnecessary diffs.\nFor example\n1)\n{code}\n-  \n-  private FakeJobInProgress submitJob(int state, int maps, int reduces, \n-      String queue, String user) throws IOException {\n+\n+  private FakeJobInProgress submitJob(int state, int maps, int reduces,\n+      String queue, String user, JobPriority priority)\n+      throws IOException {\n{code}\nHere _private FakeJobInProgress submitJob(int state, int maps, int reduces,_  should not be in the diff (removed space).\n2)\n{code}\n-  \n+\n{code}\nis useless (removed space).\n3) \n{code}\n-    FakeJobInProgress job = new FakeJobInProgress(\n-        new JobID(\"test\", ++jobCounter), jobConf, taskTrackerManager, user);\n+    FakeJobInProgress job =\n+        new FakeJobInProgress(new JobID(\"test\", ++jobCounter), jobConf,\n+            taskTrackerManager, user);\n{code}\nis also unnecessarily added to the diff.\n2) {{testJobRunStateChange()}} uses the old {{submitJob()}} api which I dont see fixed.\n----\nJust to clarify, jobs in the waiting queue can still be inited out of order when the capacity is exceeded.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-20T08:59:06.498+0000","updated":"2008-10-20T08:59:06.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12640953","id":"12640953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"body":"bq. 2) testJobRunStateChange() uses the old submitJob() api which I dont see fixed.\nI somehow missed the change. Plz ignore this comment. \n\n+1 for the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amar_kamat","name":"amar_kamat","key":"amar_kamat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amar Kamat","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-20T09:17:56.359+0000","updated":"2008-10-20T09:17:56.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641033","id":"12641033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"In an offline discussion with Vivek, we found that this patch is not correct, as it moves to the job in the next queue after initializing a job in the waiting queue. In fact, there are two deeper issues:\n\n- Currently the scheduler, which calls {{initTasks}} can trigger a set up task to be run. This does not seem correct, because just like clean up tasks, setup tasks should be done outside the control of the scheduler. This should be addressed in the framework, possibly as part of HADOOP-4421 ?\n- The capacity scheduler does not check for the status of a job to be running before assigning tasks from it when it initializes jobs in the waiting queue. The implicit assumption here was that after a call to {{initTasks}}, the job would be runnable. However, changes to the framework  to run setup tasks broke this. Even if setup tasks are done independently of the scheduler, it is still possible that the scheduler is looking at a job whose setup task is still not complete, and hence by definition is not runnable.\n\nThe first point is more of a design issue, and hence not a blocker for 0.19, as currently nothing breaks because of the approach.\n\nThe second point must be addressed in the capacity scheduler, which should actually fix the problem raised in the bug report as well. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-20T15:07:29.395+0000","updated":"2008-10-20T15:07:29.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641034","id":"12641034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"Attaching a patch that addresses the problems raised with the previous one.\n\nThe changes are:\n- We check the job state to be running before assigning a task.\n- We don't look at jobs in any other queue, if the job currently initialized is not yet running.\n- Modified the test case to make sure that in multiple queues scenario as well, no tasks are returned when a job in the waiting queue is initialized.\n\nTesting in progress.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-10-20T15:09:56.184+0000","updated":"2008-10-20T15:09:56.184+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641274","id":"12641274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"body":"bq. We don't look at jobs in any other queue, if the job currently initialized is not yet running.\n\nI wanted to consider this in some detail. When initTasks() returns, the job is still not in a running state, because its setup task needs to run first. For discussion sake, assume we have queues Q1, Q2 ... Qn and that we're considering queues in that order, starting with Q1. So after we call initTasks() on a job in Q1 (say, J1), we have the following options, in order to find a task to run: \n1. We can look at the next job in Q1 This is not a good option since we'll face the same situation - we'll call initTasks() for the next job, and then look at the next job, and so on. \n1. We can look at jobs in the next queue. This is a viable option. It does seem a bit unfair, because you're penalizing Q1 for the duration of the time it takes for J1's setup task to run, but you could equally well argue that this unfairness is temporary and is equally applicable to all queues. \n1. We can return nothing to the the TT. As a result, all TTs that send heartbeats to the JT during the time that J1's setup task is running, will get nothing to run. Most setup tasks should take a couple of heartbeats to run, so this won't be a frequent problem, but if the setup task contains user code that does a bunch of stuff, the problem is exacerbated. \n\nUpon further reflection, I'd argue for the second approach where we move on to the next queue. Returning nothing to the TTs causes unnecessary under-utilization. \n\nThe right way to do things, IMO, is get the setup/cleanup tasks out of initTasks(), which I'll argue elsewhere, but this problem (of initTasks() not necessarily changing the job's state to RUNNING) can rise up again if we decide to call initTasks() in a separate thread, the way it's done in the default scheduler. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T05:40:15.045+0000","updated":"2008-10-21T05:40:15.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641275","id":"12641275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"+1 overall.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12392491/HADOOP-4428.patch\n  against trunk revision 706463.\n\n    +1 @author.  The patch does not contain any @author tags.\n\n    +1 tests included.  The patch appears to include 3 new or modified tests.\n\n    +1 javadoc.  The javadoc tool did not generate any warning messages.\n\n    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.\n\n    +1 findbugs.  The patch does not introduce any new Findbugs warnings.\n\n    +1 Eclipse classpath. The patch retains Eclipse classpath integrity.\n\n    +1 core tests.  The patch passed core unit tests.\n\n    +1 contrib tests.  The patch passed contrib unit tests.\n\nTest results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3503/testReport/\nFindbugs warnings: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3503/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html\nCheckstyle results: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3503/artifact/trunk/build/test/checkstyle-errors.html\nConsole output: http://hudson.zones.apache.org/hudson/job/Hadoop-Patch/3503/console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T05:57:07.690+0000","updated":"2008-10-21T05:57:07.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641276","id":"12641276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"body":"I'd argue that we must look at jobs in the same queue.\n  1. The setup task is user code, and therefore could take an hour to run. It is unacceptable to completely block the queue while a job is being setup.\n  2. We would need to prevent a huge number of jobs being setup at the same time, so we should set a cap for how many jobs can be initialized at once. (3 jobs / user and 10 jobs for all users?)\n\n Further, we must keep the running jobs sorted by priority and submit time, just as the waiting list is. The fact it is not, is also a blocker.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=owen.omalley","name":"owen.omalley","key":"owen.omalley","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=owen.omalley&avatarId=29697","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=owen.omalley&avatarId=29697","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=owen.omalley&avatarId=29697","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=owen.omalley&avatarId=29697"},"displayName":"Owen O'Malley","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-10-21T05:57:22.044+0000","updated":"2008-10-21T05:57:22.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641294","id":"12641294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"body":"bq. We would need to prevent a huge number of jobs being setup at the same time, so we should set a cap for how many jobs can be initialized at once. (3 jobs / user and 10 jobs for all users?)\n\nAgreed. I actually wanted to suggest something similar but forgot to add it to my comments. Basically, you init jobs up to a limit, then you move on to the next queue. This patch should be changed to do this. \n\nbq. we must keep the running jobs sorted by priority and submit time, just as the waiting list is\n\nFair enough. I can see use cases for this. We should open another Jira for this. Implementing this functionality (sorting of run queue) will also make this Jira's solution more fair, since we won't rely on the completion times of setup tasks for jobs. \n\nAlong the same vein, there are a few more suggestions I have, for which I'll open up separate Jiras: separation of setup/clean task creation from initTasks(), and dealing with synchronous calls to initTasks() which can take a long time (thanks, Hemanth, for bringing that up). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T06:47:34.746+0000","updated":"2008-10-21T06:47:34.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12641310","id":"12641310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"body":"Summarizing the details: \n\nWe have two config values for the scheduler, regarding the number of simultaneous jobs that can be initialized: #jobs/user and #jobs/queue. These are optional settings in the scheduler's config file. Their default values are 3 and 10 respectively. \nIf these limits are met, or all jobs in a queue have been looked at, and no task has been found, the scheduler looks at the next queue. \n\nHADOOP-4471 has been created to deal with the sorting of running jobs. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vivekr","name":"vivekr","key":"vivekr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vivek Ratan","active":true,"timeZone":"Etc/UTC"},"created":"2008-10-21T08:52:29.404+0000","updated":"2008-10-21T08:52:29.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12406599/comment/12648082","id":"12648082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"body":"As per discussions that have happened on this issue, there are two separate issues identified:\n\n- Tasks get initialized without a limit on the count initialized at a given point.\n- Jobs are run out of priority order.\n\nHADOOP-4513 moves task initialization in the capacity scheduler to a separate thread. As part of that issue, we are working on limits to control the count.\nHADOOP-4471 sorts jobs in the running queue as well. Hence, jobs are now sorted in priority order everywhere.\n\nIn other words, the two identified issues are resolved if both the above JIRAs are fixed. Hence, I am closing this issue as a duplicate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yhemanth","name":"yhemanth","key":"yhemanth","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hemanth Yamijala","active":true,"timeZone":"Asia/Kolkata"},"created":"2008-11-17T05:17:12.842+0000","updated":"2008-11-17T05:17:12.842+0000"}],"maxResults":22,"total":22,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-4428/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0i7jz:"}}