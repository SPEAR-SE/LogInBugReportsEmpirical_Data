{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12712962","self":"https://issues.apache.org/jira/rest/api/2/issue/12712962","key":"HADOOP-10584","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12312322":null,"customfield_12310220":"2014-05-08T00:09:20.700+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Mar 02 02:38:13 UTC 2018","customfield_12310420":"391278","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-10584/watchers","watchCount":19,"isWatching":false},"created":"2014-05-07T22:04:41.082+0000","customfield_12310192":"Since this was mostly resolved in YARN-5677, I'm lowering the priority.","customfield_12310191":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326144","id":"12326144","description":"2.4.0 release","name":"2.4.0","archived":false,"released":true,"releaseDate":"2014-04-07"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-02T11:43:42.055+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12316608","id":"12316608","name":"ha","description":"High Availability"}],"timeoriginalestimate":null,"description":"ActiveStandbyElector retries operations for a few times. If the ZK quorum itself is down, it goes down and the daemons will have to be brought up again. \n\nInstead, it should log the fact that it is unable to talk to ZK, call becomeStandby on its client, and continue to attempt connecting to ZK.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12342324","id":"12342324","description":"3.2 release","name":"3.2.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12343006","id":"12343006","description":"2.9.2 release","name":"2.9.2","archived":false,"released":false}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12854603","id":"12854603","filename":"HADOOP-10584.prelim.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-24T23:01:58.064+0000","size":27557,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12854603/HADOOP-10584.prelim.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12644865","id":"12644865","filename":"hadoop-10584-prelim.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-05-14T18:38:19.260+0000","size":3453,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12644865/hadoop-10584-prelim.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12730902","id":"12730902","filename":"rm.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-06T18:11:10.328+0000","size":676340,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12730902/rm.log"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"391498","customfield_12312823":null,"summary":"ActiveStandbyElector goes down if ZK quorum become unavailable","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/13992371","id":"13992371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikassaha","name":"bikassaha","key":"bikassaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bikassaha&avatarId=29845","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bikassaha&avatarId=29845","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bikassaha&avatarId=29845","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bikassaha&avatarId=29845"},"displayName":"Bikas Saha","active":true,"timeZone":"America/Los_Angeles"},"body":"You mean instead of calling fatalError() like its doing now?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bikassaha","name":"bikassaha","key":"bikassaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bikassaha&avatarId=29845","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bikassaha&avatarId=29845","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bikassaha&avatarId=29845","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bikassaha&avatarId=29845"},"displayName":"Bikas Saha","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-08T00:09:20.700+0000","updated":"2014-05-08T00:09:20.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/13993080","id":"13993080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"More background: We saw this when ZK became inaccessible for a few minutes. ZKFC went down and the corresponding master was transitioned to Standby. \n\nbq. You mean instead of calling fatalError() like its doing now?\nYes. Or, we should have two retry modes. The retries we have today followed by a call to becomeStandby, within an outer retry-forever loop that sleeps for a shorter time between inner-loops.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-05-08T20:35:44.101+0000","updated":"2014-05-08T20:35:44.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/13997872","id":"13997872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"Preliminary patch that articulates what I have in mind.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-05-14T18:38:19.264+0000","updated":"2014-05-14T18:38:19.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14039564","id":"14039564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"body":"Logs from when we saw this error:\n\n{noformat}\nzzzz-yy-xx 06:01:30,039 INFO org.apache.zookeeper.ClientCnxn: Client session timed out, have not heard from server in 3335ms for sessionid 0x2459abcbfd0027f, closing socket connection and attempting reconnect\nzzzz-yy-xx 06:01:30,144 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session disconnected. Entering neutral mode...\nzzzz-yy-xx 06:01:30,233 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server MASKED-1/10.1.128.51:2181. Will not attempt to authenticate using SASL (unknown error)\nzzzz-yy-xx 06:01:30,233 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to MASKED-1/10.1.128.51:2181, initiating session\nzzzz-yy-xx 06:01:31,901 INFO org.apache.zookeeper.ClientCnxn: Client session timed out, have not heard from server in 1667ms for sessionid 0x2459abcbfd0027f, closing socket connection and attempting reconnect\nzzzz-yy-xx 06:01:32,405 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server MASKED-2/10.1.128.48:2181. Will not attempt to authenticate using SASL (unknown error)\nzzzz-yy-xx 06:01:32,406 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to MASKED-2/10.1.128.48:2181, initiating session\nzzzz-yy-xx 06:01:32,409 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server MASKED-2/10.1.128.48:2181, sessionid = 0x2459abcbfd0027f, negotiated timeout = 5000\nzzzz-yy-xx 06:01:32,412 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.\nzzzz-yy-xx 06:01:35,742 INFO org.apache.zookeeper.ClientCnxn: Client session timed out, have not heard from server in 3334ms for sessionid 0x2459abcbfd0027f, closing socket connection and attempting reconnect\nzzzz-yy-xx 06:01:35,850 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session disconnected. Entering neutral mode...\nzzzz-yy-xx 06:01:35,966 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server MASKED-3/10.1.128.49:2181. Will not attempt to authenticate using SASL (unknown error)\nzzzz-yy-xx 06:01:35,967 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to MASKED-3/10.1.128.49:2181, initiating session\nzzzz-yy-xx 06:01:35,968 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server MASKED-3/10.1.128.49:2181, sessionid = 0x2459abcbfd0027f, negotiated timeout = 5000\nzzzz-yy-xx 06:01:35,972 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.\nzzzz-yy-xx 06:01:39,303 INFO org.apache.zookeeper.ClientCnxn: Client session timed out, have not heard from server in 3335ms for sessionid 0x2459abcbfd0027f, closing socket connection and attempting reconnect\nzzzz-yy-xx 06:01:39,411 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session disconnected. Entering neutral mode...\nzzzz-yy-xx 06:01:39,904 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server MASKED-1/10.1.128.51:2181. Will not attempt to authenticate using SASL (unknown error)\nzzzz-yy-xx 06:01:39,904 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to MASKED-1/10.1.128.51:2181, initiating session\nzzzz-yy-xx 06:01:41,572 INFO org.apache.zookeeper.ClientCnxn: Client session timed out, have not heard from server in 1668ms for sessionid 0x2459abcbfd0027f, closing socket connection and attempting reconnect\nzzzz-yy-xx 06:01:41,678 FATAL org.apache.hadoop.ha.ActiveStandbyElector: Received stat error from Zookeeper. code:CONNECTIONLOSS. Not retrying further znode monitoring connection errors.\nzzzz-yy-xx 06:01:41,926 INFO org.apache.zookeeper.ZooKeeper: Session: 0x2459abcbfd0027f closed\nzzzz-yy-xx 06:01:41,927 FATAL org.apache.hadoop.ha.ZKFailoverController: Fatal error occurred:Received stat error from Zookeeper. code:CONNECTIONLOSS. Not retrying further znode monitoring connection errors.\nzzzz-yy-xx 06:01:41,927 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x2459abcbfd0027f\nzzzz-yy-xx 06:01:41,927 INFO org.apache.hadoop.ipc.Server: Stopping server on 8018\nzzzz-yy-xx 06:01:41,927 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down\nzzzz-yy-xx 06:01:41,928 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election\nzzzz-yy-xx 06:01:41,928 INFO org.apache.hadoop.ipc.Server: Stopping IPC Server listener on 8018\nzzzz-yy-xx 06:01:41,928 INFO org.apache.hadoop.ha.HealthMonitor: Stopping HealthMonitor thread\nzzzz-yy-xx 06:01:41,928 INFO org.apache.hadoop.ipc.Server: Stopping IPC Server Responder\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kkambatl","name":"kkambatl","key":"kkambatl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-06-20T23:56:47.950+0000","updated":"2014-06-20T23:56:47.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14259696","id":"14259696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"After posting the patch, I had tried to validate but couldn't reproduce it. Closing this as \"Cannot Reproduce\". Please reopen if you run into this again. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-28T18:41:49.322+0000","updated":"2014-12-28T18:41:49.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14263809","id":"14263809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"body":"I met the similar error for YARN RM that enabled HA automatic-failover. \n\n{noformat}\n2015-01-04,12:42:30,682 FATAL org.apache.hadoop.ha.ActiveStandbyElector: Received stat error from Zookeeper. code:CONNECTIONLOSS. Not retrying further znode monitoring connection errors.\n2015-01-04,12:42:30,886 INFO org.apache.zookeeper.ZooKeeper: Session: 0x2498936f2a8c448 closed\n2015-01-04,12:42:30,888 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down\n2015-01-04,12:42:30,888 FATAL org.apache.hadoop.yarn.server.resourcemanager.ResourceManager: Received a org.apache.hadoop.yarn.server.resourcemanager.RMFatalEvent of type EMBEDDED_ELECTOR_FAILED. Cause:\nReceived stat error from Zookeeper. code:CONNECTIONLOSS. Not retrying further znode monitoring connection errors.\n2015-01-04,12:42:30,891 INFO org.apache.hadoop.util.ExitUtil: Exiting with status 1\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=peng.zhang","name":"peng.zhang","key":"peng.zhang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10441","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10441","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10441","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10441"},"displayName":"Peng Zhang","active":true,"timeZone":"Asia/Shanghai"},"created":"2015-01-04T09:11:10.419+0000","updated":"2015-01-04T09:11:10.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14338725","id":"14338725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Reopening to investigate it more. If anyone wants to pick this up, they are more than welcome. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-02-26T17:23:51.922+0000","updated":"2015-02-26T17:23:51.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14531080","id":"14531080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Ran into this on one of our test clusters. Looks like this needs fixing. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-05-06T18:11:10.347+0000","updated":"2015-05-06T18:11:10.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14586986","id":"14586986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Does seem critical to me, but haven't seen any activity in a while. [~kasha] / [~xgong], can one of you comment on a possible fix? If it's uncertain, I'd like to move this to 2.7.2. Tx.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-15T21:55:03.728+0000","updated":"2015-06-15T21:55:03.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14587180","id":"14587180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"We run into this occasionally on our test clusters. From my previous investigation, the patch I posted should help. However, I couldn't test because I couldn't find a way to reproduce the problem. It should be okay to punt to 2.7.2. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-16T00:02:47.981+0000","updated":"2015-06-16T00:02:47.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14587287","id":"14587287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"body":"[~vinodkv] [~kasha]\n\nbq. From my previous investigation, the patch I posted should help.\n\nIt does help. But in the patch, reJoinElection(0) is called, which will further call  joinElectionInternal\n{code}\n  private void joinElectionInternal() {\n    Preconditions.checkState(appData != null,\n        \"trying to join election without any app data\");\n    if (zkClient == null) {\n      if (!reEstablishSession()) {\n        fatalError(\"Failed to reEstablish connection with ZooKeeper\");\n        return;\n      }\n    }\n    createRetryCount = 0;\n    wantToBeInElection = true;\n    createLockNodeAsync();\n  }\n{code}\nSince the ZK quorum is unavailable, we still have the same issue. The difference is that with the patch we will retry 45s more(by using the default configuration).\n\nSo if we will want to use retry-then-exist pattern, I think that both current code and current code + the patch are fine. We also need to modify the configurations based on the cluster.\n\nOr, if we do not expect RM exists because of this reason (ZK quorum is unavailable), instead of doing\n{code}\n    public void handle(RMFatalEvent event) {\n      LOG.fatal(\"Received a \" + RMFatalEvent.class.getName() + \" of type \" +\n          event.getType().name() + \". Cause:\\n\" + event.getCause());\n\n      ExitUtil.terminate(1, event.getCause());\n    }\n{code}\n\nWe could check the eventType, and transit the RM to standby ,then rejoin electorService.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xgong","name":"xgong","key":"xgong","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Xuan Gong","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-16T01:20:24.030+0000","updated":"2015-06-16T01:20:24.030+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14590703","id":"14590703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Moving this to 2.7.2 after ack from Karthik.\n\nbq. It does help. But in the patch, reJoinElection(0) is called, which will further call joinElectionInternal ..\nbq. Since the ZK quorum is unavailable, we still have the same issue. The difference is that with the patch we will retry 45s more(by using the default configuration).\nTx for pointing this out, [~xgong]. That still sounds bad though. IIRC, when we were originally discussing the design of state-stores for RM, we were assuming that RM should give up on Zookeeper only after trying for may be ~an hour. /cc [~jianhe]. Looking at the recent flow of tickets, that doesn't seem to be the case?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-17T22:01:16.099+0000","updated":"2015-06-17T22:01:16.099+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14591365","id":"14591365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"body":"Sorry for pitch in late. After looking at the logic, I also feel this case can occur in the production clusters. On ZooKeeper connection loss ActiveStandbyElector will do certain number of retries and finally notifies {{ActiveStandbyElectorCallback#notifyFatalError()}}. I could see the {{EmbeddedElectorService#notifyFatalError}} implementation is handling the case by immediately terminating the service. I think we have room to improve this logic instead of immediately terminating.\n\nAbout the proposed patch, IIUC it is not required to do an additional handling of ZooKeeper exceptions and do re-election in ActiveStandbyElector class. Presently we have {{ActiveStandbyElector#processWatchEvent}} logic to handle the ZK connection state changes. On connection state changes, ZooKeeper client will notify this to the registered ZK watcher like, SyncConnected, Disconnected, Expired etc. Based on the STATE {{ActiveStandbyElector}} is notifying the registered {{ActiveStandbyElectorCallback}} and does the state transitions. Please see [ActiveStandbyElector.java#L550|https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/ActiveStandbyElector.java#L550]\n\nWhat I meant is ZooKeeper client will be alive which internally does the connection re-establishment infinitely. IMHO, we could think of implemeting {{EmbeddedElectorService#enterNeutralMode}} to handle the NEUTRAL transition of RM. Also, {{ActiveStandbyElectorCallback#notifyFatalError()}} has to be refined. Any thoughts?\n\n{code}\n  public void enterNeutralMode() {\n    /**\n     * Possibly due to transient connection issues. Do nothing.\n     * TODO: Might want to keep track of how long in this state and transition\n     * to standby.\n     */\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh R","active":true,"timeZone":"Asia/Kolkata"},"created":"2015-06-18T06:58:33.039+0000","updated":"2015-06-18T06:58:33.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/14986163","id":"14986163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"body":"Too late for 2.7.2, moving this out.\n\nOverall, I am tending to think that ActiveStandbyElector is already doing the right thing and it's just the higher layers passing in insufficient retry configurations.\n\nAll the retries inside ActiveStandbyElector are for CONNECTIONLOSS and OPERATIONTIMEOUT events, so it sounds silly that we pass in a retry-count of 3 (together with a 10 seconds in YARN / 5 seconds in HDFS session time-out) in both HDFS and YARN.\n\nIf you agree, I think we should just bump up these defaults so that we can retry for 'enough' time as is acceptable. Thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vinodkv","name":"vinodkv","key":"vinodkv","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vinod Kumar Vavilapalli","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-02T22:13:44.844+0000","updated":"2015-11-02T22:13:44.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/15004828","id":"15004828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"body":"Based on my recollection from a while ago and briefly looking at the attached prelim patch, there are a couple of issues here:\n# When RM loses connection while executing an operation, the operation just fails without enough retries. The patch adds a retry-loop to handle this.\n# When RM loses connection to ZK but doesn't give up being Active. This leads to the RM continuing to serve apps and nodes connected to it. The patch, in addition to rejoining election, has the client (ZKFC/RM) enter neutral mode. Today, the RM doesn't do anything on {{enterNeutralMode}} but of course this can be improved going forward. \n\nI won't be able to work on this for the next month or so. If anyone has cycles, please feel free to take it up. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kasha","name":"kasha","key":"kasha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Karthik Kambatla","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-11-13T22:33:12.342+0000","updated":"2015-11-13T22:33:12.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/15583920","id":"15583920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"body":"Adding a 3.x fix version for tracking, good bug to get fixed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.wang","name":"andrew.wang","key":"andrew.wang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.wang&avatarId=19230","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.wang&avatarId=19230","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.wang&avatarId=19230","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.wang&avatarId=19230"},"displayName":"Andrew Wang","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-18T00:10:52.545+0000","updated":"2016-10-18T00:10:52.545+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/15872106","id":"15872106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"I'm looking at this issue now, and it seems to me that the issue could be resolved by reseting the retry counts when the session is reconnected.  If we've lost the session, then whatever retry counts we had previously don't really apply anymore, so we should reset them on reconnect.  It looks like this issue is happening only in the case that the ZK connection is flaky.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-17T16:54:13.798+0000","updated":"2017-02-17T16:54:13.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/15881687","id":"15881687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"Resetting the counts isn't the answer.  I can now reproduce this issue reliably by setting a break point in {{processWatchEvent()}} and shutting down ZK before continuing.  The issue is a race condition between the events from the ZK client and creating/statting the ZK node.  If the disconnected update event comes first, all is well.  If not, it will retry a few times and then fail the RM.\n\nTo echo earlier comments, why does ZK connection loss necessitate stopping the RM in this case?  It doesn't in any other case.  My proposal would be to remove the fatal error completely.  We could instead either transition to standby explicitly or just ignore the error (and hence the retries) on connection loss and wait for the ZK event to trigger the transition.  I kinda like the latter.  Any opinion?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-24T01:09:12.127+0000","updated":"2017-02-24T01:09:12.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/15883705","id":"15883705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"body":"Here's a rough first patch that removes the fatal errors from the {{ActiveStandbyElector}}.  I haven't done much testing yet, but I wanted to get it posted for comments.  This patch also eliminates wrapping {{InterruptedException}} in {{IOException}} so that it's possible to tell the two apart.  Feedback welcome!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=templedf","name":"templedf","key":"templedf","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=templedf&avatarId=24879","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=templedf&avatarId=24879","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=templedf&avatarId=24879","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=templedf&avatarId=24879"},"displayName":"Daniel Templeton","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-24T23:01:58.070+0000","updated":"2017-02-24T23:01:58.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12712962/comment/16383045","id":"16383045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sammi","name":"Sammi","key":"sammi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammi Chen","active":true,"timeZone":"Etc/UTC"},"body":"Hi [~templedf],  does this still target for 2.9.1?  If not, can we push this out to next 2.9.2 release? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=Sammi","name":"Sammi","key":"sammi","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sammi Chen","active":true,"timeZone":"Etc/UTC"},"created":"2018-03-02T02:38:13.634+0000","updated":"2018-03-02T02:38:13.634+0000"}],"maxResults":20,"total":20,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-10584/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1ve2f:"}}