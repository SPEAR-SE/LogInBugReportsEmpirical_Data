{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12715602","self":"https://issues.apache.org/jira/rest/api/2/issue/12715602","key":"HADOOP-10622","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326263","id":"12326263","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-05-21T00:15:22.477+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Thu Jun 12 15:17:28 UTC 2014","customfield_12310420":"393887","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_1896723008_*|*_1_*:*_1_*:*_7677158_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-06-11T22:06:35.228+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-10622/watchers","watchCount":4,"isWatching":false},"created":"2014-05-20T21:06:35.126+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325254","id":"12325254","description":"2.3.0 release","name":"2.3.0","archived":false,"released":true,"releaseDate":"2014-02-20"}],"issuelinks":[{"id":"12499290","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12499290","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"13043383","key":"HADOOP-14084","self":"https://issues.apache.org/jira/rest/api/2/issue/13043383","fields":{"summary":"Shell.joinThread swallows InterruptedException","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12388450","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12388450","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12682950","key":"HADOOP-10146","self":"https://issues.apache.org/jira/rest/api/2/issue/12682950","fields":{"summary":"Workaround JDK7 Process fd close bug","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-28T22:06:58.319+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Ran into a deadlock in Shell.runCommand.  Stacktrace details to follow.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326263","id":"12326263","description":"2.5.0 release","name":"2.5.0","archived":false,"released":true,"releaseDate":"2014-08-11"}],"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12645905","id":"12645905","filename":"HADOOP-10622.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-05-20T23:14:23.221+0000","size":930,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12645905/HADOOP-10622.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12647813","id":"12647813","filename":"HADOOP-10622.v02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-01T09:19:30.161+0000","size":2143,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12647813/HADOOP-10622.v02.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"394034","customfield_12312823":null,"summary":"Shell.runCommand can deadlock","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14003987","id":"14003987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Saw this while running the TestNodeManagerResync.testKillContainersOnResync unit test, although the nature of the deadlock looks like it could happen in other scenarios as well.\n\n{noformat}\nFound one Java-level deadlock:\n=============================\n\"Thread-163\":\n  waiting to lock monitor 0x00007f4e38086b60 (object 0x00000000ebab1508, a java.lang.UNIXProcess$ProcessPipeInputStream),\n  which is held by \"LocalizerRunner for container_0_0000_01_000000\"\n\"LocalizerRunner for container_0_0000_01_000000\":\n  waiting to lock monitor 0x00007f4e380855b8 (object 0x00000000ebab3620, a java.io.InputStreamReader),\n  which is held by \"Thread-163\"\n\nJava stack information for the threads listed above:\n===================================================\n\"Thread-163\":\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:325)\n\t- waiting to lock <0x00000000ebab1508> (a java.lang.UNIXProcess$ProcessPipeInputStream)\n\tat sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:283)\n\tat sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:325)\n\tat sun.nio.cs.StreamDecoder.read(StreamDecoder.java:177)\n\t- locked <0x00000000ebab3620> (a java.io.InputStreamReader)\n\tat java.io.InputStreamReader.read(InputStreamReader.java:184)\n\tat java.io.BufferedReader.fill(BufferedReader.java:154)\n\tat java.io.BufferedReader.readLine(BufferedReader.java:317)\n\t- locked <0x00000000ebab3620> (a java.io.InputStreamReader)\n\tat java.io.BufferedReader.readLine(BufferedReader.java:382)\n\tat org.apache.hadoop.util.Shell$1.run(Shell.java:506)\n\"LocalizerRunner for container_0_0000_01_000000\":\n\tat java.io.BufferedReader.close(BufferedReader.java:515)\n\t- waiting to lock <0x00000000ebab3620> (a java.io.InputStreamReader)\n\tat org.apache.hadoop.util.Shell.runCommand(Shell.java:574)\n\t- locked <0x00000000ebab1508> (a java.lang.UNIXProcess$ProcessPipeInputStream)\n\tat org.apache.hadoop.util.Shell.run(Shell.java:452)\n\tat org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:684)\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:773)\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:756)\n\tat org.apache.hadoop.fs.RawLocalFileSystem.setPermission(RawLocalFileSystem.java:639)\n\tat org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:288)\n\tat org.apache.hadoop.fs.FileSystem.primitiveCreate(FileSystem.java:1012)\n\tat org.apache.hadoop.fs.DelegateToFileSystem.createInternal(DelegateToFileSystem.java:85)\n\tat org.apache.hadoop.fs.ChecksumFs$ChecksumFSOutputSummer.<init>(ChecksumFs.java:351)\n\tat org.apache.hadoop.fs.ChecksumFs.createInternal(ChecksumFs.java:390)\n\tat org.apache.hadoop.fs.AbstractFileSystem.create(AbstractFileSystem.java:577)\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:666)\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:662)\n\tat org.apache.hadoop.fs.FSLinkResolver.resolve(FSLinkResolver.java:90)\n\tat org.apache.hadoop.fs.FileContext.create(FileContext.java:662)\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.writeCredentials(ResourceLocalizationService.java:1105)\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.run(ResourceLocalizationService.java:1068)\n\nFound 1 deadlock.\n{noformat}\n\nShell.runCommand has a lock on the stderr InputStream and is trying to call close() on it while the errThread it spawned earlier in the method is trying to read from the same stream.  The method tries to join with the errThread before closing, but it appears this was aborted by an InterruptedException in the case where it deadlocked (probably because the container was being killed in the unit test).  Here's the relevant snippet from the unit test log showing the method being interrupted:\n\n{noformat}\n2014-05-20 20:48:40,053 INFO  [Thread-162] nodemanager.NodeManager (NodeManager.java:run(262)) - Cleaning up running containers on resync\n2014-05-20 20:48:40,053 INFO  [Thread-162] containermanager.ContainerManagerImpl (ContainerManagerImpl.java:cleanupContainersOnNMResync(376)) - Containers still running on ON_NODEMANAGER_RESYNC : [container_0_0000_01_000000]\n2014-05-20 20:48:40,053 INFO  [Thread-162] containermanager.ContainerManagerImpl (ContainerManagerImpl.java:cleanupContainersOnNMResync(383)) - Waiting for containers to be killed\n2014-05-20 20:48:40,054 INFO  [AsyncDispatcher event handler] container.Container (ContainerImpl.java:handle(901)) - Container container_0_0000_01_000000 transitioned from LOCALIZING to KILLING\n2014-05-20 20:48:40,057 WARN  [LocalizerRunner for container_0_0000_01_000000] util.Shell (Shell.java:runCommand(533)) - Interrupted while reading the error stream\njava.lang.InterruptedException\n\tat java.lang.Object.wait(Native Method)\n\tat java.lang.Thread.join(Thread.java:1260)\n\tat java.lang.Thread.join(Thread.java:1334)\n\tat org.apache.hadoop.util.Shell.runCommand(Shell.java:531)\n\tat org.apache.hadoop.util.Shell.run(Shell.java:452)\n\tat org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:684)\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:773)\n\tat org.apache.hadoop.util.Shell.execCommand(Shell.java:756)\n\tat org.apache.hadoop.fs.RawLocalFileSystem.setPermission(RawLocalFileSystem.java:639)\n\tat org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:288)\n\tat org.apache.hadoop.fs.FileSystem.primitiveCreate(FileSystem.java:1012)\n\tat org.apache.hadoop.fs.DelegateToFileSystem.createInternal(DelegateToFileSystem.java:85)\n\tat org.apache.hadoop.fs.ChecksumFs$ChecksumFSOutputSummer.<init>(ChecksumFs.java:351)\n\tat org.apache.hadoop.fs.ChecksumFs.createInternal(ChecksumFs.java:390)\n\tat org.apache.hadoop.fs.AbstractFileSystem.create(AbstractFileSystem.java:577)\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:666)\n\tat org.apache.hadoop.fs.FileContext$3.next(FileContext.java:662)\n\tat org.apache.hadoop.fs.FSLinkResolver.resolve(FSLinkResolver.java:90)\n\tat org.apache.hadoop.fs.FileContext.create(FileContext.java:662)\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.writeCredentials(ResourceLocalizationService.java:1105)\n\tat org.apache.hadoop.yarn.server.nodemanager.containermanager.localizer.ResourceLocalizationService$LocalizerRunner.run(ResourceLocalizationService.java:1068)\n{noformat}\n\nIt looks like we need to either be a little more persistent in trying to join with the errThread before entering the finally block where we lock and try to close the input stream, or we need to rethink the locking scheme that was added in HADOOP-10146.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-05-20T21:20:25.002+0000","updated":"2014-05-20T21:20:25.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14004108","id":"14004108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Attaching a quick patch that should solve the problem for the common case where the thread is only interrupted once.  Basic idea is to remember if we successfully joined with the errThread, and if we didn't we try to do so again before attempting to close the input stream.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-05-20T23:14:23.226+0000","updated":"2014-05-20T23:14:23.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14004147","id":"14004147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12645905/HADOOP-10622.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HADOOP-Build/3957//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/3957//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-05-21T00:15:22.477+0000","updated":"2014-05-21T00:15:22.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14004355","id":"14004355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jlowe], thanks for fixing this. I think \"being more persistent\" is the correct behavior because we need to deal with spurious wake ups .\n\n{code}\n      boolean processExited = false;\n      while (!processExited) {\n        try {\n          exitCode  = process.waitFor();\n          processExited = true;\n        } catch (InterruptedException ie) {\n          // consider process.destroy() \n          if (LOG.isWarnEnabled()) {\n            LOG.warn(\"Interrupted while waiting for process exit\", ie);\n          }\n        }\n      }\n      while(errThread.isAlive()) {\n        try {\n          // make sure that the error thread exits\n          errThread.join();\n        } catch (InterruptedException ie) {\n          if (LOG.isWarnEnabled()) {\n            LOG.warn(\"Interrupted while reading the error stream\", ie);\n          }\n        }\n      }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-21T05:07:06.947+0000","updated":"2014-05-21T05:07:06.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14011626","id":"14011626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks for the review, Gera!  My patch was just a quick-n-dirty thing that doesn't cover all the cases, and I agree your proposed approach is much better.  Would you mind taking this and posting an official patch of your proposal?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-05-28T21:29:56.852+0000","updated":"2014-05-28T21:29:56.852+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14012182","id":"14012182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"Jason, I can do this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-05-29T08:09:44.947+0000","updated":"2014-05-29T08:09:44.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14014943","id":"14014943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"body":"This is my v02 based on Jason's analysis.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira.shegalov","name":"jira.shegalov","key":"jira.shegalov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gera Shegalov","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-01T09:19:30.167+0000","updated":"2014-06-01T09:19:30.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14014946","id":"14014946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"{color:red}-1 overall{color}.  Here are the results of testing the latest attachment \n  http://issues.apache.org/jira/secure/attachment/12647813/HADOOP-10622.v02.patch\n  against trunk revision .\n\n    {color:green}+1 @author{color}.  The patch does not contain any @author tags.\n\n    {color:red}-1 tests included{color}.  The patch doesn't appear to include any new or modified tests.\n                        Please justify why no new tests are needed for this patch.\n                        Also please list what manual steps were performed to verify this patch.\n\n    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.\n\n    {color:green}+1 javadoc{color}.  There were no new javadoc warning messages.\n\n    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.\n\n    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.\n\n    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.\n\n    {color:green}+1 core tests{color}.  The patch passed unit tests in hadoop-common-project/hadoop-common.\n\n    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.\n\nTest results: https://builds.apache.org/job/PreCommit-HADOOP-Build/3991//testReport/\nConsole output: https://builds.apache.org/job/PreCommit-HADOOP-Build/3991//console\n\nThis message is automatically generated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-01T10:04:33.992+0000","updated":"2014-06-01T10:04:33.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14028457","id":"14028457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"+1 lgtm.  Committing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-11T21:56:19.800+0000","updated":"2014-06-11T21:56:19.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14028470","id":"14028470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"body":"Thanks, Gera!  I committed this to trunk and branch-2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jlowe","name":"jlowe","key":"jlowe","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jason Lowe","active":true,"timeZone":"America/Chicago"},"created":"2014-06-11T22:06:35.270+0000","updated":"2014-06-11T22:06:35.270+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14028480","id":"14028480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-trunk-Commit #5685 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/5685/])\nHADOOP-10622. Shell.runCommand can deadlock. Contributed by Gera Shegalov (jlowe: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1602033)\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-11T22:13:10.889+0000","updated":"2014-06-11T22:13:10.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14029037","id":"14029037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Yarn-trunk #581 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/581/])\nHADOOP-10622. Shell.runCommand can deadlock. Contributed by Gera Shegalov (jlowe: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1602033)\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T11:26:58.819+0000","updated":"2014-06-12T11:26:58.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14029168","id":"14029168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Hadoop-Hdfs-trunk #1772 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1772/])\nHADOOP-10622. Shell.runCommand can deadlock. Contributed by Gera Shegalov (jlowe: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1602033)\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T14:08:52.551+0000","updated":"2014-06-12T14:08:52.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12715602/comment/14029240","id":"14029240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in Hadoop-Mapreduce-trunk #1799 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1799/])\nHADOOP-10622. Shell.runCommand can deadlock. Contributed by Gera Shegalov (jlowe: http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1602033)\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt\n* /hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/Shell.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2014-06-12T15:17:28.370+0000","updated":"2014-06-12T15:17:28.370+0000"}],"maxResults":14,"total":14,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-10622/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1vtlz:"}}