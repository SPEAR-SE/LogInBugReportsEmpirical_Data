{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13034767","self":"https://issues.apache.org/jira/rest/api/2/issue/13034767","key":"HADOOP-13988","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310240","id":"12310240","key":"HADOOP","name":"Hadoop Common","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10292","id":"10292","description":"Scalable Distributed Computing","name":"Hadoop"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334219","id":"12334219","description":"2.9.0 release","name":"2.9.0","archived":false,"released":true,"releaseDate":"2017-11-17"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12339180","id":"12339180","name":"3.0.0-alpha4","archived":false,"released":true,"releaseDate":"2017-07-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12342178","id":"12342178","description":"2.8.4 Release","name":"2.8.4","archived":false,"released":true,"releaseDate":"2018-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2017-01-13T18:20:42.739+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Apr 09 18:39:14 UTC 2018","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_4_*:*_6975628_*|*_4_*:*_1_*:*_437301_*|*_5_*:*_2_*:*_94317425_*|*_10002_*:*_5_*:*_1051032688","customfield_12312321":null,"resolutiondate":"2017-01-27T02:21:55.829+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-13988/watchers","watchCount":9,"isWatching":false},"created":"2017-01-13T18:09:12.824+0000","customfield_12310192":null,"customfield_12310191":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10343","value":"Reviewed","id":"10343"}],"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12310230":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12329058","id":"12329058","description":"2.8.0 release","name":"2.8.0","archived":false,"released":true,"releaseDate":"2017-03-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12334005","id":"12334005","description":"2.7.3 release","name":"2.7.3","archived":false,"released":true,"releaseDate":"2016-08-25"}],"issuelinks":[{"id":"12492596","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12492596","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"13038342","key":"HADOOP-14029","self":"https://issues.apache.org/jira/rest/api/2/issue/13038342","fields":{"summary":"Fix KMSClientProvider for non-secure proxyuser use case","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12491156","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12491156","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"outwardIssue":{"id":"12996806","key":"HADOOP-13749","self":"https://issues.apache.org/jira/rest/api/2/issue/12996806","fields":{"summary":"KMSClientProvider combined with KeyProviderCache can result in wrong UGI being used","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12491155","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12491155","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"outwardIssue":{"id":"13000990","key":"HADOOP-13558","self":"https://issues.apache.org/jira/rest/api/2/issue/13000990","fields":{"summary":"UserGroupInformation created from a Subject incorrectly tries to renew the Kerberos ticket","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2018-04-09T18:39:24.242+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12330961","id":"12330961","name":"common"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12324364","id":"12324364","name":"kms"}],"timeoriginalestimate":null,"description":"After upgrading to HDP 2.5.3.0 noticed that all of the KMSClientProvider issues have not been resolved. We put a test build together and applied HADOOP-13558 and HADOOP-13749 these two fixes did still not solve the issue with requests coming from WebHDFS through to Knox to a TDE zone.\n\nSo we added some debug to our build and determined effectively what is happening here is a double proxy situation which does not seem to work. So we propose the following fix in getActualUgi Method:\n\n{noformat}\n     }\n     // Use current user by default\n     UserGroupInformation actualUgi = currentUgi;\n     if (currentUgi.getRealUser() != null) {\n       // Use real user for proxy user\n       if (LOG.isDebugEnabled()) {\n\t   LOG.debug(\"using RealUser for proxyUser);\n\t}\n       actualUgi = currentUgi.getRealUser();\n       if (getDoAsUser() != null) {\n      \t  if (LOG.isDebugEnabled()) {\n\t\tLOG.debug(\"doAsUser exists\");\n\t\tLOG.debug(\"currentUGI realUser shortName: {}\", currentUgi.getRealUser().getShortUserName());\n\t\tLOG.debug(\"processUGI loginUser shortName: {}\", UserGroupInformation.getLoginUser().getShortUserName());\n          }\n    \t  if (currentUgi.getRealUser().getShortUserName() != UserGroupInformation.getLoginUser().getShortUserName()) {\n    \t\t  if (LOG.isDebugEnabled()) {\n\t\t  \tLOG.debug(\"currentUGI.realUser does not match UGI.processUser);\n\t\t  }\n\t\t  actualUgi = UserGroupInformation.getLoginUser();\n\t\t  if (LOG.isDebugEnabled()) {\n\t    \t  \tLOG.debug(\"LoginUser for Proxy: {}\", actualUgi.getLoginUser());\n\t\t  }\n     \t  }\n       }\n\t\n     } else if (!currentUgiContainsKmsDt() &&\n         !currentUgi.hasKerberosCredentials()) {\n       // Use login user for user that does not have either\n       // Kerberos credential or KMS delegation token for KMS operations\n       if (LOG.isDebugEnabled()) {\n\t   LOG.debug(\"using loginUser no KMS Delegation Token no Kerberos Credentials\");\n\t}\n       actualUgi = currentUgi.getLoginUser();\n     }\n     return actualUgi;\n   }\n\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12310320":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848651","id":"12848651","filename":"HADOOP-13988.01.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-20T23:15:19.064+0000","size":1857,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12848651/HADOOP-13988.01.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848656","id":"12848656","filename":"HADOOP-13988.02.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-20T23:56:26.902+0000","size":1991,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12848656/HADOOP-13988.02.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12849613","id":"12849613","filename":"HADOOP-13988.03.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T23:51:08.840+0000","size":3002,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12849613/HADOOP-13988.03.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12848433","id":"12848433","filename":"HADOOP-13988.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-20T00:43:53.468+0000","size":2986,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12848433/HADOOP-13988.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12847537","id":"12847537","filename":"HADOOP-13988.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-15T13:58:33.906+0000","size":2366,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12847537/HADOOP-13988.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"KMSClientProvider does not work with WebHDFS and Apache Knox w/ProxyUser","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"HDP 2.5.3.0 \n\nWebHDFSUser --> Knox --> HA NameNodes(WebHDFS) --> DataNodes","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822096","id":"15822096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"[~gss2002] - thank you for bringing this insight to a JIRA!\n\nI have observed this double proxying issue before and I think this may actually help it in other areas as well.\nDo you plan to provide a patch for it with appropriate tests as well?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T18:20:42.739+0000","updated":"2017-01-13T18:20:42.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822131","id":"15822131","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~gss2002] for reporting the issue and propose the fix. The proposed fix makes sense to me. \nBased on that, I think we can simplify the change below assuming the proxy user from Hadoop service will always set the UserGroupInformation.AuthenticationMethod.PROXY while proxy user from client directly will not.\n\nAlso, we should add the additional tracing to UGI#logAllUserInfo(). \n\n{code}\n if (currentUgi.getRealUser() != null) {\n      if (currentUgi.getAuthenticationMethod() == UserGroupInformation.AuthenticationMethod.PROXY) {\n        // Use login user for proxy user from another proxy server\n        actualUgi = currentUgi.getLoginUser();\n      } else {\n        // Use real user for proxy user from client directly\n        actualUgi = currentUgi.getRealUser();\n      }\n  }\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-13T18:36:01.578+0000","updated":"2017-01-13T18:36:01.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822170","id":"15822170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~lmccay] and [~xyao] I have my original patch I will attach it and we can modify and test from there.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T19:02:18.470+0000","updated":"2017-01-13T19:02:18.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822276","id":"15822276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"Initial Patch that is running in our test environment right now across 25 nodes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T20:03:59.166+0000","updated":"2017-01-13T20:03:59.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822301","id":"15822301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"This patch requires these JIRAs to be included also","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T20:17:41.749+0000","updated":"2017-01-13T20:17:41.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822348","id":"15822348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 15s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 14m 32s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 11m 29s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 27s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 11s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 17s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 39s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 58s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 53s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 11m  5s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 11m  5s{color} | {color:green} the patch passed {color} |\n| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 33s{color} | {color:orange} hadoop-common-project/hadoop-common: The patch generated 4 new + 14 unchanged - 0 fixed = 18 total (was 14) {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 10s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 19s{color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch has 3 line(s) that end in whitespace. Use git apply --whitespace=fix <<patch_file>>. Refer https://git-scm.com/docs/git-apply {color} |\n| {color:red}-1{color} | {color:red} whitespace {color} | {color:red}  0m  0s{color} | {color:red} The patch 15 line(s) with tabs. {color} |\n| {color:red}-1{color} | {color:red} findbugs {color} | {color:red}  1m 57s{color} | {color:red} hadoop-common-project/hadoop-common generated 1 new + 0 unchanged - 0 fixed = 1 total (was 0) {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 49s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  9m 45s{color} | {color:green} hadoop-common in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 32s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 59m 44s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| FindBugs | module:hadoop-common-project/hadoop-common |\n|  |  Comparison of String objects using == or != in org.apache.hadoop.crypto.key.kms.KMSClientProvider.getActualUgi()   At KMSClientProvider.java:== or != in org.apache.hadoop.crypto.key.kms.KMSClientProvider.getActualUgi()   At KMSClientProvider.java:[line 1113] |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12847413/HADOOP-13988.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 0bb3fca653a8 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / d3170f9 |\n| Default Java | 1.8.0_111 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/artifact/patchprocess/diff-checkstyle-hadoop-common-project_hadoop-common.txt |\n| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/artifact/patchprocess/whitespace-eol.txt |\n| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/artifact/patchprocess/whitespace-tabs.txt |\n| findbugs | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/artifact/patchprocess/new-findbugs-hadoop-common-project_hadoop-common.html |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11434/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-13T21:10:06.076+0000","updated":"2017-01-13T21:10:06.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822404","id":"15822404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"Looks like findbugs flagged the following:\n\n{noformat}\n+        if (currentUgi.getRealUser().getShortUserName() != UserGroupInformation.getLoginUser().getShortUserName()) {\n{noformat}\n\nThat should use an !equals() call - right?\nMay need to revisit that for your cluster.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T21:53:47.418+0000","updated":"2017-01-13T21:54:09.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822408","id":"15822408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"This has a type too:\n\n{noformat}\n+        // Check if the realUser patches the user used by process\n{noformat}\n\ns/patches/matches/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-13T21:55:32.607+0000","updated":"2017-01-13T21:55:32.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15822563","id":"15822563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":" [~lmccay] I will fix shortly!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-14T00:27:22.087+0000","updated":"2017-01-14T00:27:22.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15823068","id":"15823068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 13s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 12m 43s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 33s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 28s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  0s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 25s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 46s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 36s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 12s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  9m 12s{color} | {color:green} the patch passed {color} |\n| {color:orange}-0{color} | {color:orange} checkstyle {color} | {color:orange}  0m 28s{color} | {color:orange} hadoop-common-project/hadoop-common: The patch generated 1 new + 14 unchanged - 0 fixed = 15 total (was 14) {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 58s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 30s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 25s{color} | {color:green} hadoop-common in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 31s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 51m  2s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12847518/HADOOP-13988.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 6c1b6e6f63ed 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 2604e82 |\n| Default Java | 1.8.0_111 |\n| findbugs | v3.0.0 |\n| checkstyle | https://builds.apache.org/job/PreCommit-HADOOP-Build/11441/artifact/patchprocess/diff-checkstyle-hadoop-common-project_hadoop-common.txt |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11441/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11441/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-15T07:21:01.643+0000","updated":"2017-01-15T07:21:01.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15823161","id":"15823161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 13s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 12m 28s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 36s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 29s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 59s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 24s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 48s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 36s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 10s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  9m 10s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 28s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 57s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 29s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 48s{color} | {color:green} the patch passed {color} |\n| {color:red}-1{color} | {color:red} unit {color} | {color:red}  8m 18s{color} | {color:red} hadoop-common in the patch failed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 31s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 50m 37s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Reason || Tests ||\n| Failed junit tests | hadoop.ha.TestZKFailoverController |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12847537/HADOOP-13988.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 4e272a3cb982 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / ed09c14 |\n| Default Java | 1.8.0_111 |\n| findbugs | v3.0.0 |\n| unit | https://builds.apache.org/job/PreCommit-HADOOP-Build/11443/artifact/patchprocess/patch-unit-hadoop-common-project_hadoop-common.txt |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11443/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11443/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-15T14:59:18.362+0000","updated":"2017-01-15T14:59:18.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15823189","id":"15823189","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~lmccay] made the changes sorry for delay. I think the test error is not related to my patch can you verify also:\n\nstGracefulFailoverMultipleZKfcs(org.apache.hadoop.ha.TestZKFailoverController)  Time elapsed: 70.289 sec  <<< ERROR!\norg.apache.hadoop.ha.ServiceFailedException: Unable to become active. Local node did not get an opportunity to do so from ZooKeeper, or the local node took too long to transition to active.\n\tat org.apache.hadoop.ha.ZKFailoverController.doGracefulFailover(ZKFailoverController.java:693)\n\tat org.apache.hado","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-15T17:17:07.972+0000","updated":"2017-01-15T17:17:07.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15824639","id":"15824639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"I agree - that test fails intermittently and wouldn't be affected by this patch.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-16T21:54:58.535+0000","updated":"2017-01-16T21:54:58.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15826110","id":"15826110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"Also in regards to test case let me know as this class doesn't have much around test cases around it. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-17T14:16:11.457+0000","updated":"2017-01-17T14:16:11.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15830654","id":"15830654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"[~gss2002], the change looks good to me overall. I just have a few comments about the additional logging. \nCan you also describe the manual testing that has been done with the patch?\n\n1. Some the if(LOG.isDebugEnabled()) guard is not needed as we are using slf4j\nline 1065, 1083, 1072.\n\n2. Line 1075 can be moved into UGI#logAllUserInfo\n\n3. Log 1089-109, I think we want to log UGI#loginUser instead of UGI#loginUser#loginUser, which has already been covered in line 1075.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-19T21:43:06.394+0000","updated":"2017-01-19T21:43:06.394+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15830882","id":"15830882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~xyao] We are currently running the fix patched into our HDP 2.5.3.0 build. We grabbed the HDP-2.5.3.0-tag from HWX github and recompiled with this fix and the two fixes this is dependent on. We have been running this fix for over a week now in our test environment with 2 NNs w/HA and their associated components 3 JN's and 2 ZKFC's, 2 RM's, 4 DN's/RS's/NM's, 2 HiveServer2/Metastores, 2 HBaseMasters and a node running Knox for WebHDFS, Oozie and HiveServer2 http access and 1 Node as an Oozie Server. We have a data ingest framework that runs continuously in this environment and has run with no issues for the last week since applying the fixes and Knox to WebHDFS at a TDE file is returned correctly. I will look at adjusting the above code in regards to logging.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-20T00:21:15.165+0000","updated":"2017-01-20T00:21:15.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15830888","id":"15830888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"[~gss2002] - I just want to be clear that your latest patch is what is running in your cluster not your original one.\nThe fix that was required affected the code path taken.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-20T00:29:51.554+0000","updated":"2017-01-20T00:29:51.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15830995","id":"15830995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"yes its running in our cluster. Just put the newest patch out there here is log output from DN getting the request from Knox:\n\n2017-01-19 20:33:12,835 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:gss2002 (auth:PROXY) via knox (auth:TOKEN) from:org.apache.hadoop.hdfs.server.datanode.web.webhdfs.WebHdfsHandler.channelRead0(WebHdfsHandler.java:114)\n2017-01-19 20:33:12,835 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:gss2002 (auth:PROXY) via knox (auth:TOKEN) from:org.apache.hadoop.hdfs.server.datanode.web.webhdfs.WebHdfsHandler.channelRead0(WebHdfsHandler.java:114)\n2017-01-19 20:33:12,873 DEBUG security.SecurityUtil (SecurityUtil.java:setTokenService(421)) - Acquired token Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:12,873 DEBUG security.SecurityUtil (SecurityUtil.java:setTokenService(421)) - Acquired token Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:12,874 DEBUG security.SecurityUtil (SecurityUtil.java:setTokenService(421)) - Acquired token Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:12,874 DEBUG security.SecurityUtil (SecurityUtil.java:setTokenService(421)) - Acquired token Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,061 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:knox (auth:TOKEN) from:org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:758)\n2017-01-19 20:33:13,061 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:knox (auth:TOKEN) from:org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:758)\n2017-01-19 20:33:13,099 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: gss2002 (auth:PROXY) via knox (auth:TOKEN)\n2017-01-19 20:33:13,099 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: gss2002 (auth:PROXY) via knox (auth:TOKEN)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1776)) - +RealUGI: knox (auth:TOKEN)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1776)) - +RealUGI: knox (auth:TOKEN)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1777)) - +RealUGI: shortName: knox\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1777)) - +RealUGI: shortName: knox\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: ha-hdfs:tech, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: ha-hdfs:tech, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,100 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1784)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14666 for gss2002)\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1055)) - using RealUser for proxyUser\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1055)) - using RealUser for proxyUser\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1060)) - doAsUser exists\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1060)) - doAsUser exists\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: knox (auth:TOKEN)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: knox (auth:TOKEN)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1068)) - currentUGI.realUser does not match UGI processUser\n2017-01-19 20:33:13,101 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1068)) - currentUGI.realUser does not match UGI processUser\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,101 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +LoginUGI: dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-19 20:33:13,102 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,102 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1781)) - +LoginUGI shortName: hdfs\n2017-01-19 20:33:13,102 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS) from:org.apache.hadoop.crypto.key.kms.KMSClientProvider.createConnection(KMSClientProvider.java:524)\n2017-01-19 20:33:13,102 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS) from:org.apache.hadoop.crypto.key.kms.KMSClientProvider.createConnection(KMSClientProvider.java:524)\n2017-01-19 20:33:13,107 DEBUG security.UserGroupInformation (UserGroupInformation.java:getTGT(898)) - Found tgt Ticket (hex) = \n\nClient Principal = dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM\nServer Principal = krbtgt/TECH.HDP.EXAMPLE.COM@TECH.HDP.EXAMPLE.COM\nSession Key = EncryptionKey: keyType=18 keyBytes (hex dump)=\n\n\n\nForwardable Ticket true\nForwarded Ticket false\nProxiable Ticket false\nProxy Ticket false\nPostdated Ticket false\nRenewable Ticket false\nInitial Ticket false\nAuth Time = Thu Jan 19 20:22:30 EST 2017\nStart Time = Thu Jan 19 20:22:30 EST 2017\nEnd Time = Fri Jan 20 06:22:30 EST 2017\nRenew Till = null\nClient Addresses  Null \n2017-01-19 20:33:13,107 DEBUG security.UserGroupInformation (UserGroupInformation.java:getTGT(898)) - Found tgt Ticket (hex) = \n\n\nClient Principal = dn/ha20t5002dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM\nServer Principal = krbtgt/TECH.HDP.EXAMPLE.COM@TECH.HDP.EXAMPLE.COM\nSession Key = EncryptionKey: keyType=18 keyBytes (hex dump)=\n\nForwardable Ticket true\nForwarded Ticket false\nProxiable Ticket false\nProxy Ticket false\nPostdated Ticket false\nRenewable Ticket false\nInitial Ticket false\nAuth Time = Thu Jan 19 20:22:30 EST 2017\nStart Time = Thu Jan 19 20:22:30 EST 2017\nEnd Time = Fri Jan 20 06:22:30 EST 2017\nRenew Till = null\nClient Addresses  Null \n2017-01-19 20:33:13,122 DEBUG client.KerberosAuthenticator (KerberosAuthenticator.java:authenticate(192)) - JDK performed authentication on our behalf.\n2017-01-19 20:33:13,122 DEBUG client.KerberosAuthenticator (KerberosAuthenticator.java:authenticate(192)) - JDK performed authentication on our behalf.\n2017-01-19 20:33:13,257 INFO  DataNode.clienttrace (DataXceiver.java:requestShortCircuitShm(468)) - cliID: DFSClient_NONMAPREDUCE_513733485_146, src: 127.0.0.1, dest: 127.0.0.1, op: REQUEST_SHORT_CIRCUIT_SHM, shmId: e7f6cfb0dd48d8112883cc97c9292c4d, srvID: faca0b23-bfbe-413c-a2db-cc23c8817e87, success: true\n2017-01-19 20:33:13,262 INFO  DataNode.clienttrace (DataXceiver.java:requestShortCircuitFds(369)) - src: 127.0.0.1, dest: 127.0.0.1, op: REQUEST_SHORT_CIRCUIT_FDS, blockid: 1073781194, srvID: faca0b23-bfbe-413c-a2db-cc23c8817e87, success: true\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-20T01:38:09.097+0000","updated":"2017-01-20T01:38:09.097+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15831010","id":"15831010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~lmccay]  the logs from above are from the patch uploaded an hour ago. Let me know if it looks like code path is wrong from what I can see the code path is working correctly and the !equals is definitely working correctly if it wasn't it would of failed.\n\n\nAlso here is the patch output from my last build about an hour ago with the updated path from today:\n\nETG-GSeni-MBP:hadoop-release gss2002$ patch -p1 < ../../kmsfixes/HADOOP-13558.02.patch \npatching file hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java\nHunk #1 succeeded at 618 with fuzz 1 (offset -14 lines).\nHunk #2 succeeded at 825 (offset -40 lines).\npatching file hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/security/TestUserGroupInformation.java\nHunk #1 succeeded at 31 (offset -1 lines).\nHunk #2 succeeded at 902 with fuzz 2 (offset -111 lines).\n\n\n\n\nETG-GSeni-MBP:hadoop-release gss2002$ patch -p1 < ../../kmsfixes/HADOOP-13749.00.patch \npatching file hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java\nHunk #4 succeeded at 901 (offset 2 lines).\nHunk #5 succeeded at 924 (offset 2 lines).\nHunk #6 succeeded at 996 (offset 2 lines).\nHunk #7 succeeded at 1042 (offset 2 lines).\npatching file hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java\nHunk #1 succeeded at 1768 (offset -55 lines).\npatching file hadoop-common-project/hadoop-kms/src/test/java/org/apache/hadoop/crypto/key/kms/server/TestKMS.java\nHunk #1 succeeded at 1825 (offset -8 lines).\nHunk #2 succeeded at 2149 (offset -5 lines).\n\n\nETG-GSeni-MBP:hadoop-release gss2002$ patch -p1 < ../../HADOOP-13988.patch \npatching file hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java\nHunk #1 succeeded at 1052 (offset -10 lines).\npatching file hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java\nHunk #1 succeeded at 1774 (offset -67 lines).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-20T01:47:52.713+0000","updated":"2017-01-20T01:47:52.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15831124","id":"15831124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m 16s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 13m 26s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 11m 11s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 28s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  2s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 30s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 50s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 39s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 12s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 12s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 30s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  3s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 19s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 39s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 48s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  7m 53s{color} | {color:green} hadoop-common in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 32s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 54m 23s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12848433/HADOOP-13988.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 1892cdc91763 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 60865c8 |\n| Default Java | 1.8.0_111 |\n| findbugs | v3.0.0 |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11477/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11477/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-20T03:38:49.577+0000","updated":"2017-01-20T03:38:49.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15832594","id":"15832594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~gss2002] for posting the patch and detailed results. It helps us better understand the problem here.\n\nThe issue is caused by the real user for the proxy user - knox in this case is a token user who does not have either kms delegation token or kerberos credential on the local datanode. A cleaner fix would be merging with the logic below so that we can use kms delegation token or kerberos credential if the real user has one.\n\nPlease review and try the v01 patch attached on your cluster and let us know the result. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-20T23:15:19.070+0000","updated":"2017-01-20T23:15:19.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15832596","id":"15832596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"The comment is not valid any, we should remove it in the next patch. \n{code}\n // Add existing credentials from current UGI, since provider is cached.\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-20T23:16:55.388+0000","updated":"2017-01-20T23:16:55.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15832638","id":"15832638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Minor update to use UGI#getLoginUser() and correct comments. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-20T23:56:26.909+0000","updated":"2017-01-20T23:56:26.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15832680","id":"15832680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 17m  3s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 14m 31s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 54s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 31s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  3s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 26s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 47s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 36s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green}  9m 14s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green}  9m 14s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 29s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  0m 58s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 18s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 32s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 47s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  7m 41s{color} | {color:green} hadoop-common in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 34s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 69m 34s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12848651/HADOOP-13988.01.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux e32051fa79b9 3.13.0-95-generic #142-Ubuntu SMP Fri Aug 12 17:00:09 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 9bab85c |\n| Default Java | 1.8.0_121 |\n| findbugs | v3.0.0 |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11483/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11483/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-21T00:46:11.571+0000","updated":"2017-01-21T00:46:11.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15832701","id":"15832701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue} 17m  8s{color} | {color:blue} Docker mode activated. {color} |\n| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |\n| {color:red}-1{color} | {color:red} test4tests {color} | {color:red}  0m  0s{color} | {color:red} The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 13m 30s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 39s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 30s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m 10s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 17s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 42s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 51s{color} | {color:green} trunk passed {color} |\n| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  0m 41s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} compile {color} | {color:green} 10m 47s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javac {color} | {color:green} 10m 47s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  0m 29s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvnsite {color} | {color:green}  1m  8s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green}  0m 17s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |\n| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  1m 49s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  0m 48s{color} | {color:green} the patch passed {color} |\n| {color:green}+1{color} | {color:green} unit {color} | {color:green}  8m 43s{color} | {color:green} hadoop-common in the patch passed. {color} |\n| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 37s{color} | {color:green} The patch does not generate ASF License warnings. {color} |\n| {color:black}{color} | {color:black} {color} | {color:black} 73m  8s{color} | {color:black} {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| Docker |  Image:yetus/hadoop:a9ad5d6 |\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12848656/HADOOP-13988.02.patch |\n| Optional Tests |  asflicense  compile  javac  javadoc  mvninstall  mvnsite  unit  findbugs  checkstyle  |\n| uname | Linux 624e6cd253a4 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux |\n| Build tool | maven |\n| Personality | /testptch/hadoop/patchprocess/precommit/personality/provided.sh |\n| git revision | trunk / 9bab85c |\n| Default Java | 1.8.0_121 |\n| findbugs | v3.0.0 |\n|  Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/11486/testReport/ |\n| modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11486/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-21T01:12:05.850+0000","updated":"2017-01-21T01:12:05.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15834630","id":"15834630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~xyao] the second test fix seems to be working. I will leave it in my environment for a few days to make sure as kerberos tickets expire that the fix still works.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-23T14:15:55.532+0000","updated":"2017-01-23T14:15:55.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15834756","id":"15834756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~xyao] and [~lmccay] here is log output from 02.patch\n\n2017-01-23 10:29:17,424 DEBUG security.UserGroupInformation (UserGroupInformation.java:doAs(1744)) - PrivilegedActionException as:knox (auth:TOKEN) cause:org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.ipc.StandbyException): Operation category READ is not supported in state standby\n2017-01-23 10:29:17,424 DEBUG security.UserGroupInformation (UserGroupInformation.java:doAs(1744)) - PrivilegedActionException as:knox (auth:TOKEN) cause:org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.ipc.StandbyException): Operation category READ is not supported in state standby\n2017-01-23 10:29:17,426 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:knox (auth:TOKEN) from:org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:758)\n2017-01-23 10:29:17,426 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:knox (auth:TOKEN) from:org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:758)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: gss2002 (auth:PROXY) via knox (auth:TOKEN)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1774)) - UGI: gss2002 (auth:PROXY) via knox (auth:TOKEN)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1776)) - +RealUGI: knox (auth:TOKEN)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1776)) - +RealUGI: knox (auth:TOKEN)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1778)) - +LoginUGI: dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-23 10:29:17,437 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1778)) - +LoginUGI: dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: ha-hdfs:tech, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: ha-hdfs:tech, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.7:8020, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logAllUserInfo(1780)) - +UGI token:Kind: HDFS_DELEGATION_TOKEN, Service: 10.70.33.6:8020, Ident: (HDFS_DELEGATION_TOKEN token 14676 for gss2002)\n2017-01-23 10:29:17,438 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1061)) - using loginUser no KMS Delegation Token no Kerberos Credentials\n2017-01-23 10:29:17,438 DEBUG kms.KMSClientProvider (KMSClientProvider.java:getActualUgi(1061)) - using loginUser no KMS Delegation Token no Kerberos Credentials\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS) from:org.apache.hadoop.crypto.key.kms.KMSClientProvider.createConnection(KMSClientProvider.java:524)\n2017-01-23 10:29:17,438 DEBUG security.UserGroupInformation (UserGroupInformation.java:logPrivilegedAction(1767)) - PrivilegedAction as:dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM (auth:KERBEROS) from:org.apache.hadoop.crypto.key.kms.KMSClientProvider.createConnection(KMSClientProvider.java:524)\n2017-01-23 10:29:17,439 DEBUG security.UserGroupInformation (UserGroupInformation.java:getTGT(898)) - Found tgt Ticket (hex) = \n\n\nClient Principal = dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM\nServer Principal = krbtgt/TECH.HDP.EXAMPLE.COM@TECH.HDP.EXAMPLE.COM\nSession Key = EncryptionKey: keyType=18 keyBytes (hex dump)=\n0000: 3E 58 9C C0 36 40 0F F2   F1 BB E7 A8 4B C7 EC 89  >X..6@......K...\n0010: 96 32 E3 28 B1 47 36 D0   99 DE C9 5E 28 7F 8F 48  .2.(.G6....^(..H\n\n\nForwardable Ticket true\nForwarded Ticket false\nProxiable Ticket false\nProxy Ticket false\nPostdated Ticket false\nRenewable Ticket false\nInitial Ticket false\nAuth Time = Mon Jan 23 09:11:28 EST 2017\nStart Time = Mon Jan 23 09:11:28 EST 2017\nEnd Time = Mon Jan 23 19:11:28 EST 2017\nRenew Till = null\nClient Addresses  Null \n2017-01-23 10:29:17,439 DEBUG security.UserGroupInformation (UserGroupInformation.java:getTGT(898)) - Found tgt Ticket (hex) = \n\nClient Principal = dn/ha20t5001dn.tech.hdp.example.com@TECH.HDP.EXAMPLE.COM\nServer Principal = krbtgt/TECH.HDP.EXAMPLE.COM@TECH.HDP.EXAMPLE.COM\nSession Key = EncryptionKey: keyType=18 keyBytes (hex dump)=\n0000: 3E 58 9C C0 36 40 0F F2   F1 BB E7 A8 4B C7 EC 89  >X..6@......K...\n0010: 96 32 E3 28 B1 47 36 D0   99 DE C9 5E 28 7F 8F 48  .2.(.G6....^(..H\n\n\nForwardable Ticket true\nForwarded Ticket false\nProxiable Ticket false\nProxy Ticket false\nPostdated Ticket false\nRenewable Ticket false\nInitial Ticket false\nAuth Time = Mon Jan 23 09:11:28 EST 2017\nStart Time = Mon Jan 23 09:11:28 EST 2017\nEnd Time = Mon Jan 23 19:11:28 EST 2017\nRenew Till = null\nClient Addresses  Null \n2017-01-23 10:29:17,555 INFO  DataNode.clienttrace (DataXceiver.java:requestShortCircuitShm(468)) - cliID: DFSClient_NONMAPREDUCE_-1687232963_147, src: 127.0.0.1, dest: 127.0.0.1, op: REQUEST_SHORT_CIRCUIT_SHM, shmId: 7de3b3475df3d2cee241e9a91ee83271, srvID: 0bb43433-8195-44fa-a76b-333e779542bf, success: true\n2017-01-23 10:29:17,557 INFO  DataNode.clienttrace (DataXceiver.java:requestShortCircuitFds(369)) - src: 127.0.0.1, dest: 127.0.0.1, op: REQUEST_SHORT_CIRCUIT_FDS, blockid: 1073781194, srvID: 0bb43433-8195-44fa-a76b-333e779542bf, success: true","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-23T15:33:05.217+0000","updated":"2017-01-23T15:33:05.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15835154","id":"15835154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~gss2002] for the detailed results. Are they from the similar workload you described before? \n\n\"We have a data ingest framework that runs continuously in this environment and has run with no issues for the last week since applying the fixes and Knox to WebHDFS at a TDE file is returned correctly.\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-23T20:08:26.264+0000","updated":"2017-01-23T20:08:26.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15835267","id":"15835267","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~xyao] yes same test case using our dataingest framework that makes a curl call to verify clean data that is stored in TDE zone.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-23T21:55:54.930+0000","updated":"2017-01-23T21:55:54.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15836888","id":"15836888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"body":"+1. The latest patch looks good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jnp","name":"jnp","key":"jnp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jitendra Nath Pandey","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-25T00:02:20.215+0000","updated":"2017-01-25T00:02:20.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15837071","id":"15837071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"This patch does look good to me.\nI would like to better understand the difference between the two better however.\nI understand that it is related to when a request has a KMS delegation token already instead of having to authenticate with kerberos.\n\nMy question is how does the request coming from Knox ever get the KMS-DT?\nKnox never interacts directly with KMS and neither does the Knox enduser.\n\nThis is important in order to understand how to provide such improvements and to review such patches.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-25T02:38:28.487+0000","updated":"2017-01-25T02:38:28.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15837106","id":"15837106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~jnp] and [~lmccay] for the review. \n\nbq. Knox never interacts directly with KMS and neither does the Knox enduser.\n\nHadoop proxy user does not recommend using delegation token to proxy another user. Oozie for example uses a kerberos to proxy its end user. That's also the expected usage from HADOOP-13749. \n\nKnox can either uses UGI with kerberos to create proxy user for its end user, or impersonate end user to get KMS-DT and add it to the end user's UGI if the file accessed is in encryption zone.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-25T03:14:25.292+0000","updated":"2017-01-25T03:14:25.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15837159","id":"15837159","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay%40apache.org","name":"lmccay@apache.org","key":"lmccay@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"larry mccay","active":true,"timeZone":"Etc/UTC"},"body":"Knox doesn't use UGI at all.\nIt dispatches requests to WebHDFS via HttpClient.\nAll interactions are either with a SPNEGO authentication to WebHDFS or via\nhaoop.auth cookie/delegation token.\nIt never acquires delegation tokens directly - only what is returned via\nWebHDFS calls.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay%40apache.org","name":"lmccay@apache.org","key":"lmccay@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"larry mccay","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-25T04:10:41.088+0000","updated":"2017-01-25T04:10:41.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15838151","id":"15838151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~lmccay] for the detail of knox use case. Knox end user access webhdfs using proxy user from a token user - knox (with hdfs-dt). \n\nbq. Knox doesn't use UGI at all.\nOn the DN side, the webhdfs create UGI based on the deserialized cookie, which is the currentUGI. However, it does not have either Kerberos credential or KMS delegation token. To access KMS for encrypted files, the right UGI would be the DN's loginUser (with local kerberos credential), which fits the logic below in the latest patch.  \n\n{code}\n if (!containsKmsDt(actualUgi) && !actualUgi.hasKerberosCredentials()) {\n...\n actualUgi = UserGroupInformation.getLoginUser();\n{code} ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-25T17:09:47.880+0000","updated":"2017-01-25T17:09:47.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15838614","id":"15838614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"body":"Okay - I understand now.\nEven though the Knox usecase doesn't present a KMS delegation token as part of the request, other uses of KMSClientProvider will.\nUsecases such as Yarn acquiring the KMS-DT to provide for use with a MR job need to be accommodated.\n\nHere is my +1.\n\nThanks, [~xyao]!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lmccay","name":"lmccay","key":"lmccay","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=lmccay&avatarId=16811","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lmccay&avatarId=16811","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lmccay&avatarId=16811","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lmccay&avatarId=16811"},"displayName":"Larry McCay","active":true,"timeZone":"America/New_York"},"created":"2017-01-25T21:24:50.996+0000","updated":"2017-01-25T21:24:50.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15838629","id":"15838629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~gss2002] for the contribution and all for the discussion/reviews. I've commit the fix to trunk and branch-2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-25T21:36:55.159+0000","updated":"2017-01-25T21:36:55.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15838697","id":"15838697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #11174 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/11174/])\nHADOOP-13988. KMSClientProvider does not work with WebHDFS and Apache (xyao: rev a46933e8ce4c1715c11e3e3283bf0e8c2b53b837)\n* (edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-25T22:16:07.983+0000","updated":"2017-01-25T22:16:07.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15838925","id":"15838925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"[~xyao] and [~lmccay] thanks for all the help with this issue. I appreciate you guys digging in and helping get the right fix built.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-26T00:52:41.626+0000","updated":"2017-01-26T00:52:41.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840564","id":"15840564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks all for finding and fixing another KMSCP UGI issue... \n\nGit bisected branch-2 TestAclsEndToEnd failures to this jira. See https://builds.apache.org/job/PreCommit-HDFS-Build/18275/testReport/\n\nBoth trunk and branch-2 are failing. Could someone take a look? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T22:20:54.288+0000","updated":"2017-01-26T22:20:54.288+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840578","id":"15840578","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~xiaochen] for the heads up. Looking at it...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T22:30:29.462+0000","updated":"2017-01-26T22:30:29.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840625","id":"15840625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"body":"Is this the error we are\nTalking about:\n\nFailed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Cannot get a KDC reply)]; Host Details : local host is: \"bcf70b846b20/172.17.0.2\"; destination host is: \"localhost\":56245; \n Stack Trace\n\njava.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Cannot get a KDC reply)]; Host Details : local host is: \"bcf70b846b20/172.17.0.2\"; destination host is: \"localhost\":56245; ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gss2002","name":"gss2002","key":"gss2002","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Greg Senia","active":true,"timeZone":"America/New_York"},"created":"2017-01-26T23:03:21.450+0000","updated":"2017-01-26T23:03:21.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840636","id":"15840636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Hm, what I saw on https://builds.apache.org/job/PreCommit-HDFS-Build/18275/testReport/org.apache.hadoop.hdfs/TestAclsEndToEnd/testGoodWithWhitelistWithoutBlacklist/ is sth like this:\n{noformat}\n2017-01-26 20:32:18,448 ERROR hdfs.TestAclsEndToEnd (TestAclsEndToEnd.java:run(1644)) - IOException thrown during doAs() operation\njava.io.IOException: org.apache.hadoop.security.authentication.client.AuthenticationException: Authentication failed, URL: http://localhost:36605/kms/v1/keys?doAs=keyadmin&user.name=keyadmin, status: 403, message: Forbidden\n\tat org.apache.hadoop.crypto.key.kms.KMSClientProvider.createConnection(KMSClientProvider.java:551)\n\tat org.apache.hadoop.crypto.key.kms.KMSClientProvider.createKeyInternal(KMSClientProvider.java:732)\n\tat org.apache.hadoop.crypto.key.kms.KMSClientProvider.createKey(KMSClientProvider.java:742)\n\tat org.apache.hadoop.crypto.key.KeyProviderExtension.createKey(KeyProviderExtension.java:74)\n\tat org.apache.hadoop.hdfs.DFSTestUtil.createKey(DFSTestUtil.java:1634)\n\tat org.apache.hadoop.hdfs.DFSTestUtil.createKey(DFSTestUtil.java:1615)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd$1.execute(TestAclsEndToEnd.java:1532)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd$6.run(TestAclsEndToEnd.java:1640)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd$6.run(TestAclsEndToEnd.java:1636)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1869)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd.doUserOp(TestAclsEndToEnd.java:1636)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd.createKey(TestAclsEndToEnd.java:1528)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd.doFullAclTest(TestAclsEndToEnd.java:415)\n\tat org.apache.hadoop.hdfs.TestAclsEndToEnd.testGoodWithWhitelistWithoutBlacklist(TestAclsEndToEnd.java:369)\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T23:08:32.045+0000","updated":"2017-01-26T23:08:32.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840657","id":"15840657","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"[~gss2002], the unit test failure is different seems different. [~xiaochen], it is caused by the proxy user in non-secure case. \nWe will need to check if security is enabled before checking kerberos credential/DT as below. \n\n{code}\n--- a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java\n+++ b/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java\n@@ -1097,7 +1097,8 @@ private UserGroupInformation getActualUgi() throws IOException {\n       actualUgi = currentUgi.getRealUser();\n     }\n \n-    if (!containsKmsDt(actualUgi) &&\n+    if (UserGroupInformation.isSecurityEnabled() &&\n+        !containsKmsDt(actualUgi) &&\n         !actualUgi.hasKerberosCredentials()) {\n       // Use login user for user that does not have either\n       // Kerberos credential or KMS delegation token for KMS operations\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T23:29:37.863+0000","updated":"2017-01-27T00:17:41.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840700","id":"15840700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Attach a new patch that fix the non-secure proxy user case that was caught by the hdfs unit tests. Also fix a unit test bug in TestKMS. Please review, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T23:51:08.847+0000","updated":"2017-01-26T23:51:08.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840709","id":"15840709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Below seems to be caused by Kerberos/DNS lookup issue, which is not related to this change. \n\n{code}\njava.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Cannot get a KDC reply)]; Host Details : local host is: \"bcf70b846b20/172.17.0.2\"; destination host is: \"localhost\":56245;\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-26T23:58:18.025+0000","updated":"2017-01-26T23:58:18.025+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840804","id":"15840804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"| (x) *{color:red}-1 overall{color}* |\n\\\\\n\\\\\n|| Vote || Subsystem || Runtime || Comment ||\n| {color:blue}0{color} | {color:blue} reexec {color} | {color:blue}  0m  0s{color} | {color:blue} Docker mode activated. {color} |\n| {color:red}-1{color} | {color:red} patch {color} | {color:red}  0m  6s{color} | {color:red} HADOOP-13988 does not apply to trunk. Rebase required? Wrong Branch? See https://wiki.apache.org/hadoop/HowToContribute for help. {color} |\n\\\\\n\\\\\n|| Subsystem || Report/Notes ||\n| JIRA Issue | HADOOP-13988 |\n| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12849613/HADOOP-13988.03.patch |\n| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/11520/console |\n| Powered by | Apache Yetus 0.5.0-SNAPSHOT   http://yetus.apache.org |\n\n\nThis message was automatically generated.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2017-01-27T01:29:23.215+0000","updated":"2017-01-27T01:29:23.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/15840849","id":"15840849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"body":"Open HADOOP-14029 to fix the non-secure proxy use case and resolve this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xyao","name":"xyao","key":"xyao","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Xiaoyu Yao","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-01-27T02:21:40.712+0000","updated":"2017-01-27T02:21:40.712+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13034767/comment/16431040","id":"16431040","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"body":"Cherry-picked this to branch-2.8, together with the linked HADOOP-14029.\r\n\r\nRan TestKMS* locally before pushing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xiaochen","name":"xiaochen","key":"xiaochen","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=xiaochen&avatarId=24893","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xiaochen&avatarId=24893","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xiaochen&avatarId=24893","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xiaochen&avatarId=24893"},"displayName":"Xiao Chen","active":true,"timeZone":"America/Los_Angeles"},"created":"2018-04-09T18:39:14.065+0000","updated":"2018-04-09T18:39:14.065+0000"}],"maxResults":48,"total":48,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/HADOOP-13988/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i38oon:"}}