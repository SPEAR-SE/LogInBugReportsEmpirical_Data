{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "fields": {
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "aggregatetimeestimate": null,
        "aggregatetimeoriginalestimate": null,
        "aggregatetimespent": null,
        "assignee": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Yongjun Zhang",
            "key": "yzhangal",
            "name": "yzhangal",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yzhangal",
            "timeZone": "America/Los_Angeles"
        },
        "components": [{
            "id": "12330961",
            "name": "common",
            "self": "https://issues.apache.org/jira/rest/api/2/component/12330961"
        }],
        "created": "2017-04-18T19:49:16.000+0000",
        "creator": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Yongjun Zhang",
            "key": "yzhangal",
            "name": "yzhangal",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yzhangal",
            "timeZone": "America/Los_Angeles"
        },
        "customfield_10010": null,
        "customfield_12310191": null,
        "customfield_12310192": null,
        "customfield_12310220": "2017-04-19T06:52:46.107+0000",
        "customfield_12310222": null,
        "customfield_12310230": null,
        "customfield_12310250": null,
        "customfield_12310290": null,
        "customfield_12310291": null,
        "customfield_12310300": null,
        "customfield_12310310": "1.0",
        "customfield_12310320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12310920": "9223372036854775807",
        "customfield_12310921": null,
        "customfield_12311020": null,
        "customfield_12311024": null,
        "customfield_12311120": null,
        "customfield_12311820": "0|i3drrj:",
        "customfield_12312022": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "customfield_12312026": null,
        "customfield_12312220": null,
        "customfield_12312320": null,
        "customfield_12312321": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312324": null,
        "customfield_12312325": null,
        "customfield_12312326": null,
        "customfield_12312327": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312330": null,
        "customfield_12312331": null,
        "customfield_12312332": null,
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12312335": null,
        "customfield_12312336": null,
        "customfield_12312337": null,
        "customfield_12312338": null,
        "customfield_12312339": null,
        "customfield_12312340": null,
        "customfield_12312341": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Apr 19 06:52:46 UTC 2017",
        "customfield_12312720": null,
        "customfield_12312823": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "customfield_12312923": null,
        "customfield_12313422": "false",
        "customfield_12313520": null,
        "description": "This may apply to other components, but using HDFS as an example.\n\nWhen multiple threads use the same DFSClient to make RPC calls, they may report incorrect NN host name in the failover message:\n{code}\nINFO [pool-3-thread-13] retry.RetryInvocationHandler (RetryInvocationHandler.java:invoke(148)) - Exception while invoking delete of class ClientNamenodeProtocolTranslatorPB over *a.b.c.d*:8020. Trying to fail over immediately.\norg.apache.hadoop.ipc.RemoteException(org.apache.hadoop.ipc.StandbyException): Operation category WRITE is not supported in state standby. Visit https://s.apache.org/sbnn-error\n{code}\n\nwhere *a.b.c.d* is the RPC proxy corresponds to the active NN, which confuses user to think failover is not behaving correctly. Because *a.b.c.d*  is expected to be the proxy corresponding to the standby NN here instead.\n\nThe reason is that when the ProxyDescriptor data field of RetryInvocationHandler may be shared by multiple threads that do the RPC calls, the failover done by one thread (which changed the rpc proxy) may be visible to other threads when the other threads report the above message. \n\nAn example sequence: \n# multiple threads start with the same SNN to do RPC calls, \n# all threads discover that a failover is needed, \n# thread X failover first, and changed the ProxyDescriptor's proxyInfo to ANN\n# other threads reports the above message with the proxyInfo changed by thread X, and reported ANN instead of SNN in the message.\n\nSome details:\n\nRetryInvocationHandler does the following when failing over:\n{code}\n  synchronized void failover(long expectedFailoverCount, Method method,\n                               int callId) {\n      // Make sure that concurrent failed invocations only cause a single\n      // actual failover.\n      if (failoverCount == expectedFailoverCount) {\n        fpp.performFailover(proxyInfo.proxy);\n        failoverCount++;\n      } else {\n        LOG.warn(\"A failover has occurred since the start of call #\" + callId\n            + \" \" + proxyInfo.getString(method.getName()));\n      }\n      proxyInfo = fpp.getProxy();\n    }\n{code}\nand changed the proxyInfo in the ProxyDescriptor.\n\nWhile the log method below report message with ProxyDescriotor's proxyinfo:\n{code}\nprivate void log(final Method method, final boolean isFailover,\n      final int failovers, final long delay, final Exception ex) {\n......\n   final StringBuilder b = new StringBuilder()\n        .append(ex + \", while invoking \")\n        .append(proxyDescriptor.getProxyInfo().getString(method.getName()));\n    if (failovers > 0) {\n      b.append(\" after \").append(failovers).append(\" failover attempts\");\n    }\n    b.append(isFailover? \". Trying to failover \": \". Retrying \");\n    b.append(delay > 0? \"after sleeping for \" + delay + \"ms.\": \"immediately.\");\n{code}\nand so does  {{handleException}} method do\n{code}\n        if (LOG.isDebugEnabled()) {\n          LOG.debug(\"Exception while invoking call #\" + callId + \" \"\n              + proxyDescriptor.getProxyInfo().getString(method.getName())\n              + \". Not retrying because \" + retryInfo.action.reason, e);\n        }\n{code}\n\nFailoverProxyProvider\n{code}\n   public String getString(String methodName) {\n      return proxy.getClass().getSimpleName() + \".\" + methodName\n          + \" over \" + proxyInfo;\n    }\n\n    @Override\n    public String toString() {\n      return proxy.getClass().getSimpleName() + \" over \" + proxyInfo;\n    }\n{code}",
        "duedate": null,
        "environment": null,
        "fixVersions": [],
        "issuelinks": [],
        "issuetype": {
            "avatarId": 21133,
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "id": "1",
            "name": "Bug",
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "subtask": false
        },
        "labels": [],
        "lastViewed": null,
        "priority": {
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "id": "3",
            "name": "Major",
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3"
        },
        "progress": {
            "progress": 0,
            "total": 0
        },
        "project": {
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310240&avatarId=10095",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310240&avatarId=10095",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310240&avatarId=10095",
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310240&avatarId=10095"
            },
            "id": "12310240",
            "key": "HADOOP",
            "name": "Hadoop Common",
            "projectCategory": {
                "description": "Scalable Distributed Computing",
                "id": "10292",
                "name": "Hadoop",
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292"
            },
            "self": "https://issues.apache.org/jira/rest/api/2/project/12310240"
        },
        "reporter": {
            "active": true,
            "avatarUrls": {
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452",
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452"
            },
            "displayName": "Yongjun Zhang",
            "key": "yzhangal",
            "name": "yzhangal",
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yzhangal",
            "timeZone": "America/Los_Angeles"
        },
        "resolution": null,
        "resolutiondate": null,
        "status": {
            "description": "A patch for this issue has been uploaded to JIRA by a contributor.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/document.png",
            "id": "10002",
            "name": "Patch Available",
            "self": "https://issues.apache.org/jira/rest/api/2/status/10002",
            "statusCategory": {
                "colorName": "yellow",
                "id": 4,
                "key": "indeterminate",
                "name": "In Progress",
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4"
            }
        },
        "subtasks": [],
        "summary": "Incorrect host info may be reported in failover message",
        "timeestimate": null,
        "timeoriginalestimate": null,
        "timespent": null,
        "updated": "2017-04-19T06:52:46.000+0000",
        "versions": [],
        "votes": {
            "hasVoted": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14322/votes",
            "votes": 0
        },
        "watches": {
            "isWatching": false,
            "self": "https://issues.apache.org/jira/rest/api/2/issue/HADOOP-14322/watchers",
            "watchCount": 2
        },
        "workratio": -1
    },
    "id": "13064855",
    "key": "HADOOP-14322",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13064855"
}